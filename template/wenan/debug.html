<?php 
if($data['id'] == '128444'){die;}

$daojiri = getYuandanDay();//å€’è®¡æ—¥

$daojishi = getCountDown('2023-01-01 00:00:00');
$yuanri = (int)(getSubstr($data['content'],'è¿˜æœ‰','å¤©2023'));//åŸæ¥çš„æ—¥å­
if($yuanri != ''){
    //$data['content'] = str_replace("è¿˜æœ‰". $yuanri ."å¤©2023","è¿˜æœ‰". $daojishi ."2023å¹´",$data['content']);
    $data['content'] = "å®å’šï¼æ­å–œç©å®¶è§¦å‘è¿‡å¹´ä»»åŠ¡<br>å€’è®¡æ—¶è¿˜æœ‰21å¤©è¿‡å¹´ï¼Œè¯·åœ¨è§„å®šæ—¶é—´å†…å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š<br>1.å¼€å¼€å¿ƒå¿ƒæ¯ä¸€å¤©<br>2.æ¯å¤©éƒ½è¦è®¤çœŸå¯¹å¾…<br>3.å¤©å¤©éƒ½è¦å¥½å¥½åƒé¥­<br>4.è½¬å‘ç»™ä½ æœ€å¥½çš„10ä¸ªæœ‹å‹<br>å¦‚åœ¨è§„å®šæœŸé™å†…å®Œæˆä»¥ä¸Šä»»åŠ¡ï¼Œå°†è·å¾—â€œå¼€å¿ƒè¿›å…¥æ–°ä¸€å¹´â€å¥–åŠ±<br>å…”å¹´å¿«ä¹ï¼Œäº‹äº‹é¡ºå¿ƒï¼ï¼ï¼";
}else{
    $data['content'] = str_replace('[å…ƒæ—¦å€’è®¡æ—¥]',$daojiri,$data['content']);
}

$daojiri = getChunjieDay();//æ˜¥èŠ‚å€’è®¡æ—¥
$yuanri = (int)(getSubstr($data['content'],'è¿˜æœ‰','å¤©è¿‡å¹´'));//åŸæ¥çš„æ—¥å­
if($yuanri != ''){
    $data['content'] = str_replace("è¿˜æœ‰". $yuanri ."å¤©è¿‡å¹´","è¿˜æœ‰". $daojiri ."å¤©è¿‡å¹´",$data['content']);
}
?><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{$data.title|default="ğŸ’Œ"}</title>
    <link type="text/css" rel="stylesheet" href="{$template_path}/css/style.css?v1.0.13">
    <script>
        //åˆ¤æ–­å®¢æˆ·ç«¯è®¾å¤‡ï¼Œé€‰æ‹©å†™å…¥meta
        function init_viewport() {
            if (navigator.userAgent.indexOf('Android') != -1) {
                var version = parseFloat(RegExp.$1);
                if (version > 2.3) {
                    var width = window.outerWidth == 0 ? window.screen.width : window.outerWidth;
                    var phoneScale = parseInt(width) / 500;
                    document.write('<meta name="viewport" content="width=500, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
                } else {
                    document.write('<meta name="viewport" content="width=500, target-densitydpi=device-dpi, user-scalable=0">');
                }
            } else if (navigator.userAgent.indexOf('iPhone') != -1) {
                var phoneScale = parseInt(window.screen.width) / 500;
                document.write('<meta name="viewport" content="width=500, min-height=750, initial-scale=' + phoneScale + ', maximum-scale=' + phoneScale + ', user-scalable=0" /> ');         //0.75   0.82
            } else {
                document.write('<meta name="viewport" content="width=500, height=750, initial-scale=0.64" /> '); //0.75  0.82
            }
        }
        init_viewport();
    </script>
    <style>
        .div_is_typed{display:block;}
        .div_is_open_bg{display:none;}
        body{ margin:0 auto;}<?php  if(isset($data['is_demo']) && $data['id'] > 10753) : ?> <?php $data['opacity'] = $data['opacity'] == 100 ? 99 :  $data['opacity'];?>#div_is_inner{background: rgba(255,255,255,0.<?=$data['opacity']?>);}<?php endif;?></style>
    
</head>

<body style="overflow-x:hidden;overflow-y:hidden;">

<!--<script src="{$template_path}/js/jquery-2.0.3.min.js"></script>-->
<script src="https://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>

<div id="div_container">
    <!-- æœ€å¤–å±‚divï¼Œç”¨äºå±…ä¸­å…¼å®¹PCå’Œç§»åŠ¨ -->
    <div id="div_start_bg"></div> <!-- ç”¨äºé®æŒ¡ä¸»é¢˜ï¼Œä½œä¸ºç‰‡å¤´çš„èƒŒæ™¯ -->
    <!-- æŒ‰éœ€åŠ è½½ï¼Œé€‰æ‹©æ­¤ç‰‡å¤´æ—¶æ–¹æ‰åŠ è½½ -->
    <div id="div_intersect" style="display: block;height:100%; background-image: url(&quot;{$data.background_url}&quot;);">
        <!-- ç”¨äºè®¾ç½®èƒŒæ™¯ -->
        <div id="div_is_inner">
            <!-- ç”¨äºå­˜æ”¾content -->
            <div class="div_is_open_bg">
                <div class="div_is_open_btn" onclick="start()" style="background-image: url({$template_path}/images/open_letter.jpg);"></div>
            </div>

            <!-- æ‰“å­—åœ¨è¿™é‡Œ -->
            <div class="div_is_typed">
                <div id="div_is_img">
                    <img class="img_is_typed" src="{$data.cover_url}">
                </div>
                <span id="span_is_typed"><!--<b id="title">{$data.title}</b>-->
						<div id="box" style="text-align:left;">
                           {:str_replace(PHP_EOL,"<br>",$data.content)}
						</div>

                </span>
            </div>
        </div>
    </div>
    <script>
        var aaa = $(document).height() +2;

        $("#div_intersect").css("height",aaa + "px");
    </script>
    <div id="div_hearttree">
        <div id="div_tree_error">å¾ˆå¯æƒœä½ çš„æ‰‹æœºæµè§ˆå™¨ä¸æ”¯æŒï¼Œé”™è¿‡äº†æƒŠå–œæ•ˆæœå“¦</div>
        <div id="div_tree_start"></div>
        <div id="div_tree_main">
            <div id="div_tree_text">
                <span id="span_tree_typed"></span>
            </div>
            <canvas id="canvas_tree" width="500" height="815"></canvas>
            <div id="div_tree_timer">
                <span id="span_tree_desc"></span>
                <div id="div_tree_interval"></div>
            </div>
        </div>
    </div>

    
    <div id='div_btn_container'>
        <!-- æŒ‰é’®éƒ¨åˆ†çš„æœ€å¤–å±‚ï¼Œå¤„äºæ–‡æ¡£æµä¹‹ä¸­ -->
        <div id="div_btn_inner">
            <!-- æŒ‰é’®éƒ¨åˆ†å†…å±‚ï¼Œç”¨äºå®šä½ -->

            <div class='div_music_tips'></div>
            <div class="div_btn" id="div_music" onclick="music_switch()">
                <!--<img id='img_music' src='././images/music_note_big.png' style='-webkit-animation:music_play_rotate 1s linear infinite'>-->
                <audio id="audio_music" autoplay="autoplay" preload="auto" loop>
                    <source src="{$data.music_url}" type="audio/mpeg" />
                    <embed id="main_audio_ie8" hidden="true" autostart="true" height="0" width=0 loop="true" src="{$data.music_url}" autoplay="autoplay"/>
                </audio>
            </div>

        </div>
    </div>
    
</div>

<script src="{$template_path}/js/typeit.min.js"></script>
<script src="{$template_path}/js/su.js"></script>

<script type="text/javascript">

    var id = "{$data.id}";

    function start(){
        $(".div_is_open_bg").hide();
        $(".div_is_typed").show();
        audioAutoPlay('audio_music');

        /*
        new TypeIt('#box', {
            lifeLike: true,
            cursorSpeed: 800,
            waitUntilVisible: true,
            speed: 170
        }).go();
        */  
        $('body').wpSuperSnow({
            flakes: ['{$template_path}/images/004.png', '{$template_path}/images/003.png', '{$template_path}/images/002.png',
                '{$template_path}/images/001.png'
            ],
            totalFlakes: '50',
            zIndex: '999999',
            maxSize: '28',
            maxDuration: '20',
            useFlakeTrans: false
        });

    }

    function audioAutoPlay(id){
        var audio = document.getElementById(id),
            play = function(){
                audio.play();
                document.removeEventListener("touchstart",play, false);
            };
        audio.play();
        document.addEventListener("WeixinJSBridgeReady", function () {
            play();
        }, false);
        document.addEventListener('YixinJSBridgeReady', function() {
            play();
        }, false);
        document.addEventListener("touchstart",play, false);
    }
    
    $(function(){
        audioAutoPlay('audio_music');
        $.get("https://20it.cn/api/addViews?id={$data.id}");
    });
    

</script>

</body>
</html>